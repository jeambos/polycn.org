---
/* src/components/RecentUpdates.astro */
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');

const recentDocs = allDocs
  // 1. æ’é™¤é¦–é¡µ
  .filter((doc) => !doc.id.startsWith('index'))
  // 2. æ ¸å¿ƒä¿®å¤ï¼šæ›´å¼ºå£®çš„æ’åºé€»è¾‘
  .sort((a, b) => {
    // å¼ºåˆ¶è½¬æ¢ä¸º Any ä»¥ç»•è¿‡ TS æ£€æŸ¥ (å¦‚æœä½ çš„ç±»å‹å®šä¹‰è¿˜æ²¡ç”Ÿæ•ˆ)
    const aData = a.data as any;
    const bData = b.data as any;

    // å®‰å…¨è·å–æ—¥æœŸï¼šå¦‚æœæœ‰æ—¥æœŸå°±è½¬æ—¶é—´æˆ³ï¼Œæ²¡æœ‰æ—¥æœŸå°±å½’é›¶ (1970å¹´)
    const dateA = aData.date ? new Date(aData.date).valueOf() : 0;
    const dateB = bData.date ? new Date(bData.date).valueOf() : 0;

    // é™åºæ’åˆ— (æ•°å€¼å¤§çš„/æ–°çš„åœ¨å‰)
    return dateB - dateA;
  })
  // 3. (å¯é€‰) å†æ¬¡è¿‡æ»¤ï¼šåªæ˜¾ç¤ºçœŸæ­£æœ‰æ—¥æœŸçš„æ–‡ç« 
  // å¦‚æœä½ æƒ³æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« (åŒ…æ‹¬æ²¡æ—¥æœŸçš„)ï¼Œå°±æŠŠä¸‹é¢è¿™è¡Œæ³¨é‡Šæ‰
  .filter((doc) => (doc.data as any).date) 
  .slice(0, 3); // åªå–å‰3æ¡

// ğŸ‘‡ğŸ‘‡ğŸ‘‡ åŠ å…¥è¿™ä¸€æ®µè°ƒè¯•ä»£ç  ğŸ‘‡ğŸ‘‡ğŸ‘‡
console.log("---------------- DEBUG START ----------------");
console.log("æ‰¾åˆ°çš„æ‰€æœ‰æ–‡æ¡£æ•°é‡:", allDocs.length);
console.log("æ‰€æœ‰æ–‡æ¡£ ID:", allDocs.map(d => d.id));
console.log("Helloworld çš„æ•°æ®:", allDocs.find(d => d.id.includes('helloworld'))?.data);
console.log("æœ€ç»ˆç­›é€‰å‡ºçš„æ–‡æ¡£:", recentDocs);
console.log("---------------- DEBUG END ------------------");

---

<div class="updates-section">
  <h3>âœ¨ æœ€è¿‘æ›´æ–° (Latest)</h3>
  <div class="updates-list">
    {recentDocs.length === 0 ? (
      <p style="color:var(--sl-color-gray-3); padding:1rem;">æš‚æ— æ›´æ–°...</p>
    ) : (
      recentDocs.map((doc) => {
        // å¤„ç†æ—¥æœŸæ˜¾ç¤º
        const docDate = (doc.data as any).date;
        const dateStr = docDate ? new Date(docDate).toLocaleDateString('zh-CN') : '';
        
        // å¤„ç†é“¾æ¥ (å»æ‰ .md / .mdx åç¼€)
        const href = `/${doc.id.replace(/\.(md|mdx)$/, '')}/`;

        return (
          <a href={href} class="update-card">
            <span class="update-icon">ğŸ†•</span>
            <div class="update-info">
              <span class="update-title">{doc.data.title}</span>
              <span class="update-desc">{dateStr}</span>
            </div>
            <span class="update-arrow">â†’</span>
          </a>
        );
      })
    )}
  </div>
</div>

<style>
  .updates-section { margin-top: 4rem; }
  .updates-list { display: flex; flex-direction: column; gap: 1rem; }
  .update-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 8px;
    text-decoration: none;
    color: var(--sl-color-text);
    transition: background 0.2s;
  }
  .update-card:hover { background: var(--sl-color-gray-5); }
  .update-info { display: flex; flex-direction: column; flex: 1; }
  .update-title { font-weight: bold; color: var(--sl-color-accent); }
  .update-desc { font-size: 0.85rem; color: var(--sl-color-gray-3); }
</style>