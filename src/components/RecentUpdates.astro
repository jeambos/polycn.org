---
/* src/components/RecentUpdates.astro */
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');

const recentDocs = allDocs
  .filter((doc) => !doc.id.startsWith('index')) // æ’é™¤é¦–é¡µ
  // è¿‡æ»¤æ‰æ²¡æœ‰æ—¥æœŸçš„æ–‡ç« ï¼ˆé¿å… TS æŠ¥é”™è¯´ date å¯èƒ½æ˜¯ undefinedï¼‰
  .filter((doc) => doc.data.date !== undefined) 
  .sort((a, b) => {
    // å› ä¸ºä¸Šé¢è¿‡æ»¤è¿‡äº†ï¼Œè¿™é‡Œå¯ä»¥ç”¨ ! æ–­è¨€ date ä¸€å®šå­˜åœ¨ï¼Œæˆ–è€…ç›´æ¥æ¯”è¾ƒ
    // å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒ
    return (b.data.date!.valueOf() - a.data.date!.valueOf());
  })
  .slice(0, 3); // åªå–å‰3æ¡
---

<div class="updates-section">
  <h3>âœ¨ æœ€è¿‘æ›´æ–° (Latest)</h3>
  <div class="updates-list">
    {recentDocs.map((doc) => (
      /* ä¿®å¤è¯´æ˜ï¼š
         1. ä½¿ç”¨ doc.id ä»£æ›¿ doc.slug
         2. doc.id é€šå¸¸æ˜¯ 'folder/filename.md' æˆ– 'folder/filename'
         3. ä¸ºäº†ä¿é™©ï¼Œæˆ‘ä»¬å»æ‰å¯èƒ½å­˜åœ¨çš„ .md æˆ– .mdx åç¼€ï¼Œç¡®ä¿é“¾æ¥æ¼‚äº®
      */
      <a href={`/${doc.id.replace(/\.(md|mdx)$/, '')}/`} class="update-card">
        <span class="update-icon">ğŸ†•</span>
        <div class="update-info">
          <span class="update-title">{doc.data.title}</span>
          <span class="update-desc">
            {/* æ˜¾ç¤ºæ ¼å¼åŒ–åçš„æ—¥æœŸ */}
            {doc.data.date?.toLocaleDateString('zh-CN')}
          </span>
        </div>
        <span class="update-arrow">â†’</span>
      </a>
    ))}
  </div>
</div>

<style>
  .updates-section { margin-top: 4rem; }
  .updates-list { display: flex; flex-direction: column; gap: 1rem; }
  .update-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--sl-color-gray-6);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 8px;
    text-decoration: none;
    color: var(--sl-color-text);
    transition: background 0.2s;
  }
  .update-card:hover { background: var(--sl-color-gray-5); }
  .update-info { display: flex; flex-direction: column; flex: 1; }
  .update-title { font-weight: bold; color: var(--sl-color-accent); }
  .update-desc { font-size: 0.85rem; color: var(--sl-color-gray-3); }
</style>