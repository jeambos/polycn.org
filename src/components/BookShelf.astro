---
/* src/components/BookShelf.astro */
const books = [
  { title: "é“å¾·æµªå¥³", cover: "/images/ethical-slut.jpg", link: "/library/books/ethical-slut" },
  { title: "è¶…è¶Šå•å¶åˆ¶çš„ä¸–ç•Œ", cover: "/images/beyond-monogamy-preview.jpg", link: "/library/books/beyond-monogamy" },
  { title: "ä¸æ­¢äºäºŒ", cover: "/images/more-than-two-preview.jpg", link: "/library/books/more-than-two" },
  { title: "èµ°å‘å¼€æ”¾", cover: "/images/opening-up-preview.jpg", link: "/library/books/opening-up" },
  { title: "å¤šè¾¹å…³ç³»ä¸­çš„å®‰å…¨æ„Ÿ", cover: "/images/polysecure-preview.webp", link: "/library/books/polysecure" },
  { title: "é“å¾·æµªå¥³ï¼ˆå°ç‰ˆï¼‰", cover: "/images/ethical-slut-tw-preview.jpg", link: "/library/books/ethical-slut-tw" },
  { title: "å¦ä¸€ç§é‡è¦ä»–äºº", cover: "/images/the-other-preview.jpg", link: "/library/books/the-other" },
];
---

<div class="book-shelf-container">
  <div class="shelf-header">
    <h3>ğŸ“š è—ä¹¦ç²¾é€‰</h3>
    <a href="/library/books" class="view-all">æŸ¥çœ‹å…¨éƒ¨ &rarr;</a>
  </div>
  
  <div class="book-scroll" id="bookScrollArea">
    {books.map(book => (
      <a href={book.link} class="book-item">
        <div class="cover-wrapper">
          <img src={book.cover} alt={book.title} loading="lazy" />
        </div>
        <span class="book-title">{book.title}</span>
      </a>
    ))}
    <div class="spacer" style="min-width: 1px;"></div>
  </div>
</div>

<script>
  const scrollArea = document.getElementById('bookScrollArea');
  
  if (scrollArea) {
    // --- åŠŸèƒ½ 1: æ™ºèƒ½æ»šè½®æ”¯æŒ (åˆ°åº•è‡ªåŠ¨é‡Šæ”¾) ---
    scrollArea.addEventListener('wheel', (evt) => {
      // åªæœ‰å½“å†…å®¹æº¢å‡ºæ—¶æ‰å¤„ç†
      if (scrollArea.scrollWidth <= scrollArea.clientWidth) return;

      const isScrollingDown = evt.deltaY > 0;
      const isScrollingUp = evt.deltaY < 0;
      
      const maxScrollLeft = scrollArea.scrollWidth - scrollArea.clientWidth;
      const currentScrollLeft = scrollArea.scrollLeft;
      
      // å®¹å·®å€¼ (å¤„ç†é«˜åˆ†å±ä¸‹çš„åƒç´ å°æ•°é—®é¢˜)
      const tolerance = 2; 

      // åˆ¤æ–­è¾¹ç•Œæƒ…å†µ
      const atRightEdge = currentScrollLeft >= maxScrollLeft - tolerance;
      const atLeftEdge = currentScrollLeft <= tolerance;

      // æ ¸å¿ƒé€»è¾‘ï¼šæ™ºèƒ½æ”¾è¡Œ
      if (isScrollingDown && atRightEdge) {
        // 1. å¦‚æœæ˜¯å¾€å³æ»‘ï¼Œä¸”å·²ç»åˆ°äº†æœ€å³è¾¹ -> ä¸æ‹¦æˆªï¼Œè®©é¡µé¢å‘ä¸‹æ»š
        return; 
      }
      
      if (isScrollingUp && atLeftEdge) {
        // 2. å¦‚æœæ˜¯å¾€å·¦æ»‘ï¼Œä¸”å·²ç»åˆ°äº†æœ€å·¦è¾¹ -> ä¸æ‹¦æˆªï¼Œè®©é¡µé¢å‘ä¸Šæ»š
        return;
      }

      // 3. å…¶ä»–æƒ…å†µ -> æ‹¦æˆªæ»šè½®ï¼Œè½¬æ¢ä¸ºæ¨ªå‘æ»‘åŠ¨
      evt.preventDefault();
      scrollArea.scrollLeft += evt.deltaY;
    }, { passive: false }); // å…³é”®ï¼šæ ‡è®°ä¸ºéè¢«åŠ¨ï¼Œå…è®¸æˆ‘ä»¬é˜»æ­¢é»˜è®¤è¡Œä¸º


    // --- åŠŸèƒ½ 2: è¿›åœºå›å¼¹åŠ¨ç”» ---
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          scrollArea.classList.add('hint-animation');
          observer.disconnect();
        }
      });
    }, { threshold: 0.3 });

    observer.observe(scrollArea);
  }
</script>

<style>
  .book-shelf-container {
    margin: 3rem 0;
  }
  
  .shelf-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
  }
  
  .shelf-header h3 {
    font-size: 1.5rem;
    margin: 0;
    color: var(--sl-color-white);
  }
  
  .view-all {
    font-size: 0.9rem;
    color: var(--sl-color-accent);
    text-decoration: none;
    font-weight: bold;
  }

  /* --- æ ¸å¿ƒæ»šåŠ¨åŒºåŸŸ --- */
  .book-scroll {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 0.5rem 0.5rem 1.5rem 0.5rem;
    scroll-behavior: smooth; /* è®©æ»šè½®æ»šåŠ¨æ—¶æ›´å¹³æ»‘ */
    
    /* å…³é”®è®¾ç½®ï¼šæ˜¾ç¤ºç¾åŒ–åçš„æ»šåŠ¨æ¡ */
    scrollbar-width: thin; 
    scrollbar-color: var(--sl-color-accent) var(--sl-color-gray-6);
  }
  
  /* Chrome/Safari/Edge æ»šåŠ¨æ¡æ ·å¼å®šåˆ¶ */
  .book-scroll::-webkit-scrollbar {
    height: 6px; /* ç»†æ¡é«˜åº¦ */
  }
  
  .book-scroll::-webkit-scrollbar-track {
    background: var(--sl-color-gray-6); /* è½¨é“é¢œè‰² */
    border-radius: 3px;
  }
  
  .book-scroll::-webkit-scrollbar-thumb {
    background-color: var(--sl-color-accent); /* æ»‘å—é¢œè‰² (æ©™è‰²) */
    border-radius: 3px;
    cursor: pointer;
  }
  
  .book-scroll::-webkit-scrollbar-thumb:hover {
    background-color: var(--sl-color-text-accent); /* æ‚¬åœåŠ æ·± */
  }

  /* --- è¿›åœºåŠ¨ç”» --- */
  @keyframes scrollHint {
    0% { transform: translateX(0); }
    20% { transform: translateX(-40px); }
    50% { transform: translateX(-40px); }
    100% { transform: translateX(0); }
  }

  :global(.hint-animation) .book-item {
    animation: scrollHint 1.2s ease-in-out;
  }

  /* --- å•æœ¬ä¹¦æ ·å¼ --- */
  .book-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    
    flex-shrink: 0;
    width: 160px; /* è¿™é‡Œçš„å®½åº¦æ˜¯ä½ ä¿®æ”¹åçš„ */
    
    transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  .book-item:hover {
    transform: translateY(-8px);
  }

  /* --- å°é¢å®¹å™¨ --- */
  .cover-wrapper {
    width: 100%;
    aspect-ratio: 2 / 3;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    
    border-radius: 4px; /* è¿™é‡Œæ˜¯ä½ ä¿®æ”¹åçš„å°åœ†è§’ */
    
    overflow: hidden;
    margin-bottom: 0.8rem;
    background: var(--sl-color-gray-5);
    position: relative;
  }
  
  .cover-wrapper::after {
    content: "";
    position: absolute;
    top: 0; left: 0; bottom: 0;
    width: 4px;
    background: rgba(255,255,255,0.1);
    z-index: 1;
  }

  /* --- å›¾ç‰‡å¤„ç† --- */
  img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover; 
    object-position: top center; 
    /* å»æ‰äº† scale ç¼©æ”¾åŠ¨ç”» */
  }
  
  .book-title {
    font-size: 1rem;
    line-height: 1.4;
    color: var(--sl-color-text);
    text-align: center;
    font-weight: 500;
    
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>