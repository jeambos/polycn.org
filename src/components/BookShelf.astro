---
/* src/components/BookShelf.astro */
const books = [
  { title: "é“å¾·æµªå¥³", cover: "/images/ethical-slut.jpg", link: "/library/books/ethical-slut" },
  { title: "è¶…è¶Šå•å¶åˆ¶çš„ä¸–ç•Œ", cover: "/images/beyond-monogamy-preview.jpg", link: "/library/books/beyond-monogamy" },
  { title: "ä¸æ­¢äºäºŒ", cover: "/images/more-than-two-preview.jpg", link: "/library/books/more-than-two" },
  { title: "èµ°å‘å¼€æ”¾", cover: "/images/opening-up-preview.jpg", link: "/library/books/opening-up" },
  { title: "å¤šè¾¹å…³ç³»ä¸­çš„å®‰å…¨æ„Ÿ", cover: "/images/polysecure-preview.webp", link: "/library/books/polysecure" },
  { title: "é“å¾·æµªå¥³ï¼ˆå°ç‰ˆï¼‰", cover: "/images/ethical-slut-tw-preview.jpg", link: "/library/books/ethical-slut-tw" },
  { title: "å¦ä¸€ç§é‡è¦ä»–äºº", cover: "/images/the-other-preview.jpg", link: "/library/books/the-other" },
];
---

<div class="book-shelf-container">
  <div class="shelf-header">
    <h3>ğŸ“š è—ä¹¦ç²¾é€‰</h3>
    <a href="/library/books" class="view-all">æŸ¥çœ‹å…¨éƒ¨ &rarr;</a>
  </div>
  
  <div class="book-scroll" id="bookScrollArea">
    {books.map(book => (
      <a href={book.link} class="book-item">
        <div class="cover-wrapper">
          <img src={book.cover} alt={book.title} loading="lazy" />
        </div>
        <span class="book-title">{book.title}</span>
      </a>
    ))}
    <div class="spacer" style="min-width: 1px;"></div>
  </div>
</div>

<script>
  // äº¤äº’é€»è¾‘ï¼šå½“ç»„ä»¶è¿›å…¥è§†å£æ—¶ï¼Œè§¦å‘â€œå›å¼¹â€åŠ¨ç”»
  const scrollArea = document.getElementById('bookScrollArea');
  
  if (scrollArea) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // æ·»åŠ åŠ¨ç”»ç±»
          scrollArea.classList.add('hint-animation');
          // åŠ¨ç”»åªæ’­æ”¾ä¸€æ¬¡ï¼Œæ’­æ”¾å®Œå°±åœæ­¢ç›‘å¬
          observer.disconnect();
        }
      });
    }, { threshold: 0.3 }); // å½“ 30% çš„åŒºåŸŸè¿›å…¥å±å¹•æ—¶è§¦å‘

    observer.observe(scrollArea);
  }
</script>

<style>
  .book-shelf-container {
    margin: 3rem 0;
  }
  
  .shelf-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
  }
  
  .shelf-header h3 {
    font-size: 1.5rem;
    margin: 0;
  }
  
  .view-all {
    font-size: 0.9rem;
    color: var(--sl-color-accent);
    text-decoration: none;
    font-weight: bold;
  }

  /* --- æ ¸å¿ƒæ»šåŠ¨åŒºåŸŸ --- */
  .book-scroll {
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    padding: 0.5rem 0.5rem 1.5rem 0.5rem; /* åº•éƒ¨ç•™å¤šç‚¹ padding ç»™æŠ•å½± */
    scroll-behavior: smooth;
    
    /* 1. éšè—æ»šåŠ¨æ¡ (è¿™æ˜¯ç°ä»£åšæ³•) */
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
  }
  
  /* Chrome/Safari éšè—æ»šåŠ¨æ¡ */
  .book-scroll::-webkit-scrollbar {
    display: none;
  }

  /* --- 2. äº¤äº’åŠ¨ç”» --- */
  /* å®šä¹‰åŠ¨ç”»ï¼šå‘å·¦æ»‘åŠ¨ä¸€ç‚¹ç‚¹ï¼Œå†å¼¹å›æ¥ */
  @keyframes scrollHint {
    0% { transform: translateX(0); }
    20% { transform: translateX(-40px); } /* å‘å·¦éœ²å‡ºæ¥ 40px */
    50% { transform: translateX(-40px); } /* ç¨å¾®åœé¡¿ä¸€ä¸‹ */
    100% { transform: translateX(0); }    /* å¼¹å›å» */
  }

  /* JS ä¼šåŠ ä¸Šè¿™ä¸ªç±»ï¼Œè§¦å‘åŠ¨ç”» */
  :global(.hint-animation) .book-item {
    animation: scrollHint 1.2s ease-in-out;
  }
  
  /* æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ delay è®©ä¹¦æœ¬äº§ç”Ÿæ³¢æµªæ•ˆæœï¼Œæˆ–è€…æ•´ä½“ç§»åŠ¨ */
  /* è¿™é‡Œé€‰æ‹©æ•´ä½“ç§»åŠ¨ï¼Œä¸åŠ  delayï¼Œé¿å…å¤ªä¹± */

  /* --- å•æœ¬ä¹¦æ ·å¼ --- */
  .book-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    
    /* é˜²æ­¢è¢«å‹ç¼©ï¼Œä¿æŒå›ºå®šå®½åº¦ */
    flex-shrink: 0;
    width: 140px; 
    
    transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  /* æ‚¬åœä¸Šæµ®æ•ˆæœ */
  .book-item:hover {
    transform: translateY(-8px);
  }

  /* --- å°é¢å®¹å™¨ (ç›¸æ¡†æ³•åˆ™) --- */
  .cover-wrapper {
    width: 100%;
    
    /* å…³é”®è®¾ç½®ï¼šå›ºå®šçºµæ¨ªæ¯” 2:3 (å¸¸è§ä¹¦ç±æ¯”ä¾‹) */
    aspect-ratio: 2 / 3;
    
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    border-radius: 6px; /* åœ†è§’ç¨å¾®å¤§ä¸€ç‚¹ */
    overflow: hidden;
    margin-bottom: 0.8rem;
    background: var(--sl-color-gray-5); /* å›¾ç‰‡åŠ è½½å‰çš„åº•è‰² */
    position: relative;
  }
  
  /* ä¹¦è„Šæ•ˆæœï¼šå·¦ä¾§åŠ ä¸€æ¡æ·¡æ·¡çš„ç™½å…‰ï¼Œæ›´æœ‰ç«‹ä½“æ„Ÿ */
  .cover-wrapper::after {
    content: "";
    position: absolute;
    top: 0; left: 0; bottom: 0;
    width: 4px;
    background: rgba(255,255,255,0.1);
    z-index: 1;
  }

  /* --- å›¾ç‰‡å¤„ç† --- */
  img {
    display: block;
    width: 100%;
    height: 100%;
    
    /* å…³é”®è®¾ç½®ï¼šå¡«æ»¡ç›¸æ¡†ï¼Œè£åˆ‡å¤šä½™éƒ¨åˆ† */
    object-fit: cover; 
    /* ç¡®ä¿ä¹¦ååœ¨ä¸Šé¢æ—¶ï¼Œä¼˜å…ˆå±•ç¤ºå›¾ç‰‡ä¸Šæ–¹ */
    object-position: top center; 
    
    transition: transform 0.3s;
  }
  
  .book-item:hover img {
    transform: scale(1.05); /* æ‚¬åœæ—¶å›¾ç‰‡å¾®ç¼©æ”¾ */
  }

  .book-title {
    font-size: 1rem;
    line-height: 1.4;
    color: var(--sl-color-text);
    text-align: center;
    font-weight: 500;
    
    /* é™åˆ¶æ ‡é¢˜æœ€å¤šæ˜¾ç¤ºä¸¤è¡Œï¼Œè¶…å‡ºçœç•¥ */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>